(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();const b={};function A(t,e){b[t]||(b[t]=[]),b[t].push(e)}function y(t,e){b[t]&&b[t].forEach(a=>a(e))}function j(t,e=null){try{const a=localStorage.getItem(t);return a?JSON.parse(a):e}catch{return e}}function P(t,e){try{return localStorage.setItem(t,JSON.stringify(e)),!0}catch{return!1}}const c={tasks:[],ui:{lastCreatedTaskId:null},filters:{search:"",status:"all",priority:"all",sort:"createdAt-desc"},modal:{open:!1,mode:"create",editingTaskId:null},storageAvailable:!0};function q(t){Object.assign(c,t),y("state:updated",c)}function h(t){Object.assign(c.filters,t),y("filters:updated",c.filters)}function k(t){Object.assign(c.modal,t),y("modal:updated",c.modal)}function U(t){const e={id:crypto.randomUUID(),title:t.title.trim(),description:t.description.trim(),priority:t.priority,completed:t.completed==="true",createdAt:Date.now()},a=[...c.tasks,e];q({tasks:a,ui:{...c.ui,lastCreatedTaskId:e.id}}),w(a),y("tasks:updated")}function L(t,e){const a=c.tasks.map(s=>s.id===t?{...s,...e}:s);q({tasks:a}),w(a),y("tasks:updated")}function H(t){const e=c.tasks.find(a=>a.id===t);L(t,{completed:!e.completed})}function w(t){P("tasks",t)}function O(t){const e=c.tasks.filter(a=>a.id!==t);q({tasks:e}),w(e),y("tasks:updated")}function R(t,e){const a={id:crypto.randomUUID(),parentId:t,title:e.title.trim(),description:e.description.trim(),priority:e.priority,completed:!1,createdAt:Date.now()},s=[...c.tasks,a];q({tasks:s}),w(s),y("tasks:updated")}function F(t){if(!Array.isArray(t)||t.length===0)return;const e=new Map(c.tasks.map(o=>[o.id,o])),a=t.map(o=>e.get(o)).filter(Boolean);if(a.length===0)return;const s=new Set(a.map(o=>o.id));let n=0;const r=c.tasks.map(o=>s.has(o.id)?a[n++]:o);q({tasks:r}),w(r),y("tasks:updated")}function X(){document.querySelector("[data-theme-toggle]").addEventListener("click",()=>{const s=document.documentElement.dataset.theme==="light"?"dark":"light";document.documentElement.dataset.theme=s,localStorage.setItem("theme",s)});const e=localStorage.getItem("theme");e&&(document.documentElement.dataset.theme=e)}function _(){const t=document.querySelector("[data-filter='search']");t&&t.addEventListener("input",n=>{h({search:n.target.value})});const e=document.querySelectorAll("[data-filter='status']");e.length>0&&e.forEach(n=>{n.addEventListener("click",()=>{e.forEach(r=>r.setAttribute("aria-pressed",!1)),n.setAttribute("aria-pressed",!0),h({status:n.dataset.filterValue})})});const a=document.querySelector("[data-toolbar-tabs]"),s=document.querySelector("[data-toolbar]");if(a&&s){const n=Array.from(a.querySelectorAll("[data-toolbar-tab]")),r=i=>{s.dataset.activeTab=i,n.forEach(d=>{const f=d.dataset.toolbarTab===i;d.setAttribute("aria-selected",f?"true":"false")})},o=s.dataset.activeTab||n[0]?.dataset.toolbarTab;o&&r(o),n.forEach(i=>{i.addEventListener("click",()=>r(i.dataset.toolbarTab))})}}function V(){document.querySelectorAll("[data-select]").forEach(W)}function v(t,e){if(!t)return;const a=t.querySelector("[data-select-trigger]"),s=t.querySelector("[data-select-value]"),n=t.querySelectorAll(".select-option"),r=Array.from(n).find(o=>o.dataset.value===e);r&&(n.forEach(o=>o.removeAttribute("aria-selected")),r.setAttribute("aria-selected","true"),s.textContent=r.textContent,t.dataset.value=e,a?.setAttribute("aria-expanded","false"),B(t,e))}function W(t){const e=t.querySelector("[data-select-trigger]"),a=t.querySelector("[data-select-dropdown]"),s=t.querySelector("[data-select-value]"),n=t.querySelectorAll(".select-option");let r=!1;function o(l=null){document.querySelectorAll("[data-select]").forEach(m=>{if(m!==l){m.dataset.open="false";const u=m.querySelector("[data-select-dropdown]");u&&(u.dataset.open="false",u.hidden=!0)}})}function i(){r=!0,a.hidden=!1,requestAnimationFrame(()=>{a.dataset.open="true",t.dataset.open="true"})}function d(){r=!1,a.dataset.open="false",t.dataset.open="false",setTimeout(()=>a.hidden=!0,140)}e.addEventListener("click",l=>{l.stopPropagation(),r?d():(o(t),i())}),n.forEach(l=>{l.addEventListener("click",m=>{m.stopPropagation(),f(l),d(),Y(t,l.dataset.value),t.dispatchEvent(new CustomEvent("select:change",{detail:{value:l.dataset.value}}))}),e.addEventListener("keydown",m=>{const u=Array.from(n),g=u.find(S=>S.dataset.active==="true")||u.find(S=>S.getAttribute("aria-selected")==="true");let p=u.indexOf(g);switch(m.key){case"ArrowDown":m.preventDefault(),r||(o(t),i()),I(u),p=Math.min(p+1,u.length-1),T(u[p]);break;case"ArrowUp":m.preventDefault(),r||(o(t),i()),I(u),p=Math.max(p-1,0),T(u[p]);break;case"Enter":r&&g&&(m.preventDefault(),g.click());break;case"Escape":r&&(m.preventDefault(),d(),e.focus());break}})});function f(l){const m=l.dataset.value;n.forEach(u=>u.removeAttribute("aria-selected")),l.setAttribute("aria-selected","true"),s.textContent=l.textContent,t.dataset.value=m,B(t,m)}document.addEventListener("click",l=>{!t.contains(l.target)&&r&&d()})}function T(t){t.focus(),t.dataset.active="true"}function I(t){t.forEach(e=>delete e.dataset.active)}function Y(t,e){const a=t.dataset.selectType;a==="priority"&&h({priority:e}),a==="sort"&&h({sort:e})}function B(t,e){const a=t.dataset.selectType;if(a==="modal-priority"){const s=t.parentElement.querySelector("input[name='priority']");s&&(s.value=e)}if(a==="modal-status"){const s=t.parentElement.querySelector("input[name='completed']");s&&(s.value=e)}}function K(){const t=document.querySelector("[data-task-form]");t.addEventListener("input",e=>{const a=e.target,s=a.name,n=t.querySelector(`[data-error-for="${s}"]`);if(x[s]){const r=x[s](a.value);r?(n.textContent=r,a.closest(".field").dataset.invalid="true"):(n.textContent="",a.closest(".field").dataset.invalid="false")}}),t.addEventListener("submit",e=>{e.preventDefault();let a=!0;if(Object.keys(x).forEach(r=>{const o=t.elements[r];if(!o)return;const i=t.querySelector(`[data-error-for="${r}"]`),d=x[r](o.value);d?(i.textContent=d,o.closest(".field").dataset.invalid="true",a=!1):(i.textContent="",o.closest(".field").dataset.invalid="false")}),!a)return;const s=Object.fromEntries(new FormData(t)),n={...s,completed:s.completed==="true"};c.modal.mode==="create"?U(n):c.modal.mode==="subtask"?R(c.modal.parentId,n):L(c.modal.editingTaskId,n),k({open:!1}),t.reset()})}const x={title(t){return t.trim()?t.length<3?"Минимум 3 символа":null:"Введите заголовок"},description(t){return t.length>500?"Описание слишком длинное":null}};function N(t){const e=c.tasks.find(a=>a.id===t);e&&(k({open:!0,mode:"edit",editingTaskId:t}),requestAnimationFrame(()=>{const a=document.querySelector("[data-task-form]");a.elements.title.value=e.title,a.elements.description.value=e.description,a.elements.priority.value=e.priority,a.elements.completed.value=e.completed;const s=document.querySelector("[data-select-type='modal-priority']"),n=document.querySelector("[data-select-type='modal-status']");v(s,e.priority),v(n,String(e.completed)),a.elements.title.focus()}))}function $(t){k({open:!0,mode:"subtask",parentId:t}),requestAnimationFrame(()=>{const e=document.querySelector("[data-task-form]");e.reset(),e.elements.title.focus(),document.querySelector("[data-modal-title]").textContent="Новая подзадача"})}function J(){const t=document.querySelector("[data-task-form]");if(!t)return;t.reset(),t.elements.priority.value="medium",t.elements.completed.value="false";const e=document.querySelector("[data-select-type='modal-priority']"),a=document.querySelector("[data-select-type='modal-status']");v(e,"medium"),v(a,"false");const s=document.querySelector("[data-modal-title]");s&&(s.textContent="Новая задача")}function G(){const t=document.querySelector("[data-segmented]");if(!t)return;const e=t.querySelector("[data-indicator]"),a=[...t.querySelectorAll(".segment")];s(a.find(n=>n.getAttribute("aria-pressed")==="true")),a.forEach(n=>{n.addEventListener("click",()=>{a.forEach(r=>r.setAttribute("aria-pressed","false")),n.setAttribute("aria-pressed","true"),s(n),h({status:n.dataset.filterValue})})});function s(n){const{offsetLeft:r,offsetWidth:o}=n;e.style.left=`${r-0}px`,e.style.width=`${o}px`,e.style.opacity="1"}}function z(){const t=document.querySelector("[data-modal='task']");if(!t)return;const e=t.querySelector("[data-modal-backdrop]"),a=t.querySelectorAll("[data-modal-close]");e.addEventListener("click",()=>{k({open:!1})}),a.forEach(s=>{s.addEventListener("click",n=>{n.preventDefault(),k({open:!1})})}),document.addEventListener("keydown",s=>{s.key==="Escape"&&c.modal.open&&k({open:!1})})}A("modal:updated",Q);function Q(){const t=document.querySelector("[data-modal='task']");t&&(c.modal.open?(t.hidden=!1,requestAnimationFrame(()=>{t.dataset.state="open"})):(t.dataset.state="closing",setTimeout(()=>{t.hidden=!0},250)))}function Z(){const t=document.querySelector("[data-modal='task']"),e=t.querySelector(".modal__dialog"),a=t.querySelector("[data-modal-drag-handle]");if(!a)return;let s=0,n=0,r=!1;a.addEventListener("mousedown",o=>{r=!0;const i=e.getBoundingClientRect();s=o.clientX-i.left,n=o.clientY-i.top,e.style.transition="none"}),document.addEventListener("mousemove",o=>{r&&(e.style.position="absolute",e.style.left=`${o.clientX-s}px`,e.style.top=`${o.clientY-n}px`)}),document.addEventListener("mouseup",()=>{r=!1,e.style.transition=""})}function tt(t){let e=[...t];const a=c.filters;if(a.search.trim()){const s=a.search.toLowerCase();e=e.filter(n=>n.title.toLowerCase().includes(s)||n.description.toLowerCase().includes(s))}return a.status!=="all"&&(e=e.filter(s=>a.status==="completed"?s.completed:!s.completed)),a.priority!=="all"&&(e=e.filter(s=>s.priority===a.priority)),a.sort!=="manual"&&(e=et(e,a.sort)),e}function et(t,e){const[a,s]=e.split("-"),n=s==="asc"?1:-1;return[...t].sort((r,o)=>{if(a==="priority"){const i={high:3,medium:2,low:1};return(i[r.priority]-i[o.priority])*n}return typeof r[a]=="string"?r[a].localeCompare(o[a])*n:(r[a]-o[a])*n})}const at=`
<svg viewBox="0 0 24 24" fill="none"
     stroke="currentColor" stroke-width="1.8"
     stroke-linecap="round" stroke-linejoin="round">
  <rect x="5" y="5" width="14" height="14" rx="3" />
</svg>`,nt=`
<svg viewBox="0 0 24 24" fill="none"
     stroke="currentColor" stroke-width="1.8"
     stroke-linecap="round" stroke-linejoin="round">
  <rect x="5" y="5" width="14" height="14" rx="3" />
  <path d="M9 12.5l2.5 2.5L15 10" />
</svg>`;function C(){const t=document.querySelector("[data-tasks-root]"),e=document.querySelector("[data-state='empty']"),a=document.querySelector("[data-state='error']"),s=document.querySelector("[data-state='loading']"),n=tt(c.tasks);s.hidden=!0,a.hidden=c.storageAvailable,e.hidden=n.length>0,t.innerHTML="";const r=document.getElementById("task-card-template"),{lastCreatedTaskId:o}=c.ui;n.forEach((i,d)=>{const f=r.content.cloneNode(!0),l=f.querySelector(".task-card");l.style.animationDelay=`${d*40}ms`,l.dataset.taskId=i.id,l.dataset.state=i.completed?"completed":"active",l.dataset.priority=i.priority;const m=f.querySelector("[data-task-checkbox]");m.innerHTML=i.completed?nt:at,m.dataset.state=i.completed?"checked":"unchecked",i.id===o&&l.classList.add("task-card--new"),f.querySelector("[data-task-title]").textContent=i.title,f.querySelector("[data-task-description]").textContent=i.description,f.querySelector("[data-task-priority]").textContent=st(i.priority);const u=new Date(i.createdAt),g=f.querySelector("[data-task-date]"),p=u.toLocaleDateString("ru-RU"),S=u.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});g.innerHTML=`<span>${p}</span><span>${S}</span>`,t.appendChild(f)})}function rt(){const t=document.querySelector("[data-tasks-root]");if(!t)return;t.addEventListener("dblclick",a=>{const s=a.target.closest("[data-task-title]"),n=a.target.closest("[data-task-description]");s&&e(s,"title"),n&&e(n,"description")});function e(a,s){const r=a.closest(".task-card").dataset.taskId,o=a.textContent.trim(),i=s==="title"?document.createElement("input"):document.createElement("textarea");i.className=a.className+" task-card__input",i.value=o,i.rows=s==="description"?3:void 0,a.replaceWith(i),i.focus(),i.select?.();const d=f=>{const l=i.value.trim(),m=f&&l?l:o,u=document.createElement(s==="title"?"h3":"p");u.className=a.className,u.dataset[s==="title"?"taskTitle":"taskDescription"]="",u.textContent=m,i.replaceWith(u),f&&l!==o&&L(r,{[s]:m})};i.addEventListener("blur",()=>d(!0)),i.addEventListener("keydown",f=>{f.key==="Enter"&&s==="title"&&(f.preventDefault(),d(!0)),f.key==="Escape"&&d(!1)})}}function st(t){return{high:"Высокий",medium:"Средний",low:"Низкий"}[t]??t}function ot(){const t=document.querySelector("[data-tasks-root]");if(!t)return;let e=null;t.addEventListener("dragstart",r=>{const o=r.target.closest("[data-drag-handle]");if(!o){r.preventDefault();return}const i=o.closest(".task-item");i&&(e=i.querySelector(".task-card")?.dataset.taskId,r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/plain",e||""),i.classList.add("task-item--dragging"))}),t.addEventListener("dragend",r=>{r.target.closest(".task-item")?.classList.remove("task-item--dragging"),s(t),e=null}),t.addEventListener("dragover",r=>{r.preventDefault();const o=t.querySelector(".task-item--dragging");if(!o)return;const i=r.target.closest(".task-item");if(!i||i===o){s(t),i||t.appendChild(o);return}n(t,i);const d=a(i,r.clientX,r.clientY,o);d==null?t.appendChild(o):t.insertBefore(o,d)}),t.addEventListener("drop",()=>{const r=[...t.querySelectorAll(".task-card")].map(o=>o.dataset.taskId);s(t),c.filters.sort!=="manual"&&(h({sort:"manual"}),v(document.querySelector("[data-select-type='sort']"),"manual")),F(r)});function a(r,o,i,d){const f=r.getBoundingClientRect(),l=f.left+f.width/2,m=f.top+f.height/2,u=o-l,g=i-m;if(!(Math.abs(u)>Math.abs(g)?u>0:g>0))return r;let E=r.nextElementSibling;for(;E&&E===d;)E=E.nextElementSibling;return E}function s(r){r.querySelectorAll(".task-item--drop-target").forEach(o=>o.classList.remove("task-item--drop-target"))}function n(r,o){s(r),o&&o.classList.add("task-item--drop-target")}}document.addEventListener("DOMContentLoaded",()=>{y("dom:ready");const t=j("tasks",[]);q({tasks:t}),X(),_(),K(),V(),G(),z(),Z(),C(),rt(),ot()});document.addEventListener("click",t=>{t.target.closest("[data-action='open-create-modal']")&&(k({open:!0,mode:"create",editingTaskId:null}),requestAnimationFrame(()=>{J()}))});document.addEventListener("click",t=>{const e=t.target.closest("[data-action]");if(!e)return;const a=e.dataset.action,n=e.closest(".task-card")?.dataset.taskId;switch(a){case"toggle-completed":H(n);break;case"edit-task":N(n);break;case"delete-task":O(n);break;case"add-subtask":$(n);break;case"move-up":M(n,-1);break;case"move-down":M(n,1);break}});document.addEventListener("click",t=>{const e=document.querySelector("[data-context-menu]"),a=t.target.closest("[data-action='open-context-menu']");if(a){const r=a.closest(".task-card").dataset.taskId,o=a.getBoundingClientRect();e.hidden=!1,e.style.left="0px",e.style.top="0px";const{left:i,top:d}=it(e,o);e.style.left=i+"px",e.style.top=d+"px",e.dataset.taskId=r,requestAnimationFrame(()=>{e.dataset.open="true"});return}const s=t.target.closest("[data-context]");if(s){const n=e.dataset.taskId,r=s.dataset.context;r==="edit"&&N(n),r==="delete"&&O(n),r==="subtask"&&$(n),D();return}t.target.closest("[data-context-menu]")||D()});function D(){const t=document.querySelector("[data-context-menu]");t.dataset.open="false",setTimeout(()=>t.hidden=!0,150)}function it(t,e){const s=t.getBoundingClientRect();let n=e.right-s.width;n+s.width+8>window.innerWidth&&(n=window.innerWidth-s.width-8),n<8&&(n=8);let r=e.bottom+8;return r+s.height+8>window.innerHeight&&(r=e.top-s.height-8),r<8&&(r=8),{left:n,top:r}}function M(t,e){const a=document.querySelector("[data-tasks-root]");if(!a)return;const s=[...a.querySelectorAll(".task-card")],n=s.findIndex(d=>d.dataset.taskId===t);if(n===-1)return;const r=n+e;if(r<0||r>=s.length)return;const o=s.map(d=>d.dataset.taskId),i=o[n];o[n]=o[r],o[r]=i,ct(),F(o)}function ct(){c.filters.sort!=="manual"&&(h({sort:"manual"}),v(document.querySelector("[data-select-type='sort']"),"manual"))}A("tasks:updated",C);A("filters:updated",C);A("modal:updated",()=>{c.modal.open&&requestAnimationFrame(()=>{document.querySelector("[name='title']")?.focus()})});document.querySelector("[data-footer-year]").textContent=new Date().getFullYear();
